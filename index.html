<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product Selection</title>
<meta name="robots" content="noindex, nofollow">
<style>
  body { font-family: sans-serif; padding: 20px; }

  .lang { display:flex; gap:8px; margin-bottom: 10px; }
  .lang button {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:110px;
    height:38px;
    padding:0 12px;
    border-radius:10px;
    font-weight:600;
    line-height:1;
    border:1px solid #ccc;
    background:#fff;
    cursor:pointer;
  }
  .lang button:hover { background:#f5f5f5; }

  .product { border:1px solid #ddd; padding:10px; margin-bottom:10px; display:flex; gap:10px; border-radius:12px; }
  .product img { width:100px; height:auto; border-radius:10px; object-fit:cover; background:#f2f2f2; }
  .cart { border-top:2px solid #000; padding-top:10px; margin-top: 18px; }
  input[type=number]{ width:72px; }

  .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .btn {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    height:38px;
    padding:0 14px;
    border-radius:10px;
    border:1px solid #111;
    background:#111;
    color:#fff;
    font-weight:700;
    cursor:pointer;
  }
  .btn.secondary {
    background:#fff;
    color:#111;
    border:1px solid #ccc;
    font-weight:600;
  }

  .note {
    margin-top: 8px;
    font-size: 12px;
    color: #666;
  }

  select {
    height:38px;
    border-radius:10px;
    padding:0 10px;
    border:1px solid #ccc;
    background:#fff;
  }

  .summary {
    margin-top: 10px;
    line-height: 1.6;
  }

  footer { font-size:12px; color:#666; margin-top:30px; }
</style>
</head>
<body>

<div class="lang">
  <button onclick="setLang('jp')">日本語</button>
  <button onclick="setLang('en')">English</button>
</div>

<h2 id="title">注文商品選択</h2>
<p id="desc">ご希望の商品と数量を選択してください。</p>

<div id="products"></div>

<div class="cart">
  <h3 id="cartTitle">注文内容</h3>
  <ul id="cartList"></ul>

  <!-- ✅ 쿠폰: input -> dropdown -->
  <div class="row" style="margin: 10px 0;">
    <span id="couponLabel">クーポン:</span>
    <select id="couponSelect" onchange="applyCoupon()">
      <option value="NONE">（選択しない）</option>
      <option value="LINE05" selected>LINE05（5%OFF）</option>
      <option value="WELCOME10">WELCOME10（10%OFF）</option>
    </select>
  </div>

  <!-- ✅ 첫구매 안내 문구 -->
  <div class="note" id="welcomeNote">※ 初回購入の場合は「WELCOME10」を選択してください。</div>

  <!-- ✅ 소계 / 할인 / 합계 표시 -->
  <div class="summary">
    <div><span id="subtotalLabel">小計</span>: <strong id="subtotalText">¥0</strong></div>
    <div><span id="discountLabel">割引</span>: <strong id="discountText">-¥0</strong></div>
    <div style="margin-top:6px;"><span id="totalLabel">合計金額</span>: <strong id="totalText">¥0</strong></div>
  </div>

  <div class="note" id="shippingNote">※ 配送料は別途計算されます。</div>

  <div style="margin-top: 14px;" class="row">
    <button class="btn" onclick="goLine()" id="lineBtn">LINEで相談する</button>
    <button class="btn secondary" onclick="copyOnly()" id="copyBtn">内容をコピー</button>
  </div>

  <div class="note" id="copyHint" style="display:none;">
    コピーしました。LINEのトークに貼り付けて送信してください。
  </div>
</div>

<footer id="footerText">
本ページは参考用のリストです。オンライン注文・決済は行っておりません。
</footer>

<script>
let lang = "jp";
let discountRate = 0.95; // ✅ 기본값 LINE05
const couponRules = {
  NONE: {
    rate: 1.00,
    maxOff: 0,
    note: { jp: "", en: "" }
  },
  LINE05: {
    rate: 0.95,
    maxOff: 5000,
    note: {
      jp: "※ LINEでのご注文時にご利用いただけます（5%OFF／最大割引¥5,000）",
      en: "Available for orders placed via LINE (5% OFF / Max ¥5,000 discount)"
    }
  },
  WELCOME10: {
    rate: 0.90,
    maxOff: 10000,
    note: {
      jp: "※ 初回購入の場合にご利用ください（10%OFF／最大割引¥10,000）",
      en: "For first-time purchases (10% OFF / Max ¥10,000 discount)"
    }
  }
};



const products = [
  { no: 1,  code:"01", name:{ en:"DERMATOLOGY SKIN CARE SET", ja:"ダーマトロジー スキンケアセット" }, price:24200, img:"images/01.jpg" },
  { no: 2,  code:"02", name:{ en:"DUAL CREAM RECOVERY SET", ja:"デュアルクリームリカバリーセット" }, price:33900, img:"images/02.jpg" },
  { no: 3,  code:"03", name:{ en:"DERMATOLOGY FIRST PACKAGE", ja:"ダーマトロジー ファースト パッケージ" }, price:14500, img:"images/03.jpg" },
  { no: 4,  code:"04", name:{ en:"DERMATOLOGY CREAM", ja:"ダーマトロジー クリーム" }, price:9700, img:"images/04.jpg" },
  { no: 5,  code:"05", name:{ en:"TWO PHASE OIL MIST", ja:"ツーフェーズオイルミスト" }, price:5700, img:"images/05.jpg" },
  { no: 6,  code:"06", name:{ en:"CALMING BALANCE GEL", ja:"カーミングバランスジェル" }, price:5700, img:"images/06.jpg" },
  { no: 7,  code:"07", name:{ en:"MOISTURE CLEANSING OIL", ja:"モイスチャークレンジングオイル" }, price:4900, img:"images/07.jpg" },
  { no: 8,  code:"08", name:{ en:"CLEANSING POWDER WASH", ja:"クレンジングパウダーウォッシュ" }, price:4900, img:"images/08.jpg" },
  { no: 9,  code:"09", name:{ en:"MOISTURE LAYER SUN PROTECTOR SPF50+ PA++++", ja:"モイスチャー サンプロテクター" }, price:4100, img:"images/09.jpg" },
  { no: 10, code:"10", name:{ en:"ICD BEAUTY SHEER GLOW BB", ja:"シアグロウBB" }, price:4600, img:"images/10.jpg" },
  { no: 11, code:"11", name:{ en:"MULTI STICK BALM", ja:"マルチスティックバーム" }, price:4100, img:"images/11.jpg" },
  { no: 12, code:"12", name:{ en:"ICD CUSHION 21", ja:"クッションファンデー21号" }, price:8800, img:"images/12.jpg" },
  { no: 13, code:"13", name:{ en:"ICD CUSHION 23", ja:"クッションファンデー23号" }, price:8800, img:"images/13.jpg" },
  { no: 14, code:"14", name:{ en:"COLLAGEN 100 MELTING MASK", ja:"コラーゲン100 メルティングマスク" }, price:10000, img:"images/14.jpg" },
  { no: 15, code:"15", name:{ en:"RADIANSOME TONER", ja:"ラディアンソーム トナー" }, price:11100, img:"images/15.jpg" },
  { no: 16, code:"16", name:{ en:"RADIANSOME ESSENSE", ja:"ラディアンソーム エッセンス" }, price:16900, img:"images/16.jpg" },
  { no: 17, code:"17", name:{ en:"RADIANSOME CREAM", ja:"ラディアンソーム クリーム" }, price:14300, img:"images/17.jpg" },
];

const text = {
  jp: {
    title: "商品構成選択",
    desc: "ご希望の商品と数量を選択してください。",
    cart: "選択内容",
    couponLabel: "クーポン:",
    welcome: "※ 初回購入の場合は「WELCOME10」を選択してください。",
    subtotal: "小計",
    discount: "割引",
    total: "合計金額",
    lineBtn: "LINEで相談する",
    copyBtn: "内容をコピー",
    qtyLabel: "数量",
    shipNote: "※ 配送料は別途計算されます。",
    footer: "本ページは参考用のリストです。オンライン注文・決済は行っておりません。",
    copiedHint: "コピーしました。LINEのトークに貼り付けて送信してください。"
  },
  en: {
    title: "Order List",
    desc: "Select products and quantities.",
    cart: "Selected Items",
    couponLabel: "Coupon:",
    welcome: "If this is your first purchase, choose WELCOME10.",
    subtotal: "Subtotal",
    discount: "Discount",
    total: "Total",
    lineBtn: "Chat on LINE",
    copyBtn: "Copy details",
    qtyLabel: "Qty",
    shipNote: "Shipping fee will be calculated separately.",
    footer: "This page is for reference only. No online ordering or payment is processed here.",
    copiedHint: "Copied. Paste it into LINE chat and send."
  }
};

let cart = {}; // code -> qty

function setLang(l){
  lang = l;
  document.getElementById("title").innerText = text[l].title;
  document.getElementById("desc").innerText = text[l].desc;
  document.getElementById("cartTitle").innerText = text[l].cart;

  document.getElementById("couponLabel").innerText = text[l].couponLabel;
  document.getElementById("welcomeNote").innerText = text[l].welcome;

  document.getElementById("subtotalLabel").innerText = text[l].subtotal;
  document.getElementById("discountLabel").innerText = text[l].discount;
  document.getElementById("totalLabel").innerText = text[l].total;

  document.getElementById("lineBtn").innerText = text[l].lineBtn;
  document.getElementById("copyBtn").innerText = text[l].copyBtn;
  document.getElementById("shippingNote").innerText = text[l].shipNote;
  document.getElementById("footerText").innerText = text[l].footer;

  render();
  applyCoupon(); // ✅ 현재 선택된 쿠폰 문구를 새 언어로 갱신

}

function render(){
  const div = document.getElementById("products");
  div.innerHTML = "";

  products.forEach(p => {
    const qty = cart[p.code] ?? 0;

    div.innerHTML += `
      <div class="product">
        <img src="${p.img}" alt="${escapeHtml(p.name[lang==='jp'?'ja':'en'])}"
             onerror="this.style.opacity=.2; this.alt='(no image)';">
        <div>
          <strong>${p.no}. ${p.name[lang==='jp'?'ja':'en']}</strong><br>
          <span style="opacity:.8;">¥${p.price.toLocaleString()}</span><br><br>

          ${text[lang].qtyLabel}:
          <input type="number" min="0" max="20" value="${qty}"
            onchange="updateQty('${p.code}', this.value)">
        </div>
      </div>
    `;
  });

  renderCart();
}

function updateQty(code, val){
  const n = Math.max(0, Math.min(20, parseInt(val || "0", 10)));
  if (n === 0) delete cart[code];
  else cart[code] = n;
  renderCart();
}

function getSubtotal(){
  let subtotal = 0;
  for (let c in cart){
    const p = products.find(x => x.code === c);
    if (!p) continue;
    subtotal += p.price * cart[c];
  }
  return subtotal;
}

function getTotal(){
  const subtotal = getSubtotal();
  const v = document.getElementById("couponSelect")?.value || "NONE";
  const rule = couponRules[v] || couponRules.NONE;

  const percentOff = Math.round(subtotal * (1 - rule.rate));
  const cappedOff = Math.min(percentOff, rule.maxOff);

  return Math.max(0, subtotal - cappedOff);
}

function renderCart(){
  const ul = document.getElementById("cartList");
  ul.innerHTML = "";

  const items = [];
  for (let c in cart){
    const p = products.find(x => x.code === c);
    if (!p) continue;
    const sub = p.price * cart[c];
    items.push({ no: p.no, name: p.name[lang==='jp'?'ja':'en'], qty: cart[c], sub });
  }
  items.sort((a,b)=>a.no-b.no);

  items.forEach(it => {
    ul.innerHTML += `<li>${it.no}. ${escapeHtml(it.name)} × ${it.qty} = ¥${it.sub.toLocaleString()}</li>`;
  });

  const subtotal = getSubtotal();
  const total = getTotal();
  const discountAmt = Math.max(0, subtotal - total);

  document.getElementById("subtotalText").innerText = "¥" + subtotal.toLocaleString();
  document.getElementById("discountText").innerText = "-¥" + discountAmt.toLocaleString();
  document.getElementById("totalText").innerText = "¥" + total.toLocaleString();
}

// ✅ 드롭다운 값에 따라 할인율 변경
function applyCoupon(){
  const v = document.getElementById("couponSelect").value;
  const rule = couponRules[v] || couponRules.NONE;

  // 할인율 저장(표시용)
  discountRate = rule.rate;

  // ✅ 쿠폰별 문구 자동 표시
  const noteEl = document.getElementById("welcomeNote");
  const msg = rule.note[lang === "jp" ? "jp" : "en"];

  if (msg) {
    noteEl.innerText = msg;
    noteEl.style.display = "block";
  } else {
    noteEl.innerText = "";
    noteEl.style.display = "none";
  }

  renderCart();
}


async function goLine(){
  const msg = buildMessage();
  await copyToClipboard(msg);
  const url = "https://line.me/R/msg/text/?" + encodeURIComponent(msg);
  window.open(url, "_blank");
  showCopiedHint();
}

async function copyOnly(){
  const msg = buildMessage();
  await copyToClipboard(msg);
  showCopiedHint();
}

function buildMessage(){
  const items = [];
  for (let c in cart){
    const p = products.find(x => x.code === c);
    if (!p) continue;
    items.push({ no: p.no, name: p.name[lang==='jp'?'ja':'en'], qty: cart[c] });
  }
  items.sort((a,b)=>a.no-b.no);

  const lines = [];
  lines.push(lang === "jp" ? "【ご希望内容】" : "[Request]");
  if (items.length === 0) {
    lines.push(lang === "jp" ? "(未選択)" : "(none selected)");
  } else {
    items.forEach(it => lines.push(`${it.no}. ${it.name} × ${it.qty}`));
  }

  const coupon = document.getElementById("couponSelect").value;
  if (coupon !== "NONE") {
    lines.push((lang==="jp" ? "クーポン: " : "Coupon: ") + coupon);
  }

  const subtotal = getSubtotal();
  const total = getTotal();
  const discountAmt = Math.max(0, subtotal - total);

  lines.push((lang==="jp" ? "小計: ¥" : "Subtotal: ¥") + subtotal.toLocaleString());
  lines.push((lang==="jp" ? "割引: -¥" : "Discount: -¥") + discountAmt.toLocaleString());
  lines.push((lang==="jp" ? "合計金額: ¥" : "Total: ¥") + total.toLocaleString());
  lines.push(lang === "jp" ? "※ 配送料は別途計算されます。" : "Shipping fee will be calculated separately.");

  return lines.join("\n");
}

async function copyToClipboard(textValue){
  try {
    await navigator.clipboard.writeText(textValue);
  } catch (e) {
    const ta = document.createElement("textarea");
    ta.value = textValue;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    document.body.removeChild(ta);
  }
}

function showCopiedHint(){
  const el = document.getElementById("copyHint");
  el.innerText = text[lang].copiedHint;
  el.style.display = "block";
  setTimeout(()=>{ el.style.display = "none"; }, 3000);
}

function escapeHtml(s){
  return String(s)
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

// ✅ 초기: JP + LINE05 적용
setLang("jp");
applyCoupon();
</script>

</body>
</html>
